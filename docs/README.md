# 예매
## 예매 흐름
날짜, 영화, 영화관 선택 → 상영 시간 선택 → 인원, 좌석 선택 → 결제 → 예매 확인</br>
</br>

## 상영 시간표 조회
날짜, (영화), 영화관 선택 → 상영 시간 조회</br>
</br>

### 영화 조회
날짜, (영화관) 선택 → 영화 상영 유무 포함하여 영화 리스트 반환</br>
</br>

### 지역 리스트 조회
날짜, (영화) 선택 → 전체 지역 리스트와 각 지역별 상영시간 갯수 조회</br>
</br>

### 영화관 리스트 조회
날짜, (영화), 지역 선택 → 지역별 영화관 리스트와 각 영화관별 상영시간 갯수 조회</br>
</br>

## 좌석 선택, 예매 가능 여부 확인
- 좌석을 선택할 시, 해당 좌석 예매 가능 여부 실시간 확인
- 좌석을 선택하면, 결제 완료 여부와 관계없이 해당 좌석은 즉시 `판매대기` 상태로 변경
- 좌석이 `판매대기` 중이거나 이미 `예매`된 경우, 다른 좌석을 선택하도록 안내
- 결제 및 예매 확정은 순차적으로 진행 (멀티스레드 동시성)
- TODO: 일정 시간동안 결제가 진행되지 않거나, 사용자가 페이지를 나갈 경우 좌석을 `사용가능` 상태로 변경
</br>

## 예매 생성
- 좌석을 선택 후 결제를 완료하면 예매를 확정 및 결제 내역 정보 저장
</br>

## 예매 확인
- 예매된 내역을 확인할 수 있도록 예매 정보를 사용자에게 제공
</br>

## 예매 및 결제 취소
- 기존 예매를 취소할 경우 예매 및 결제 취소
- 좌석 `사용가능` 상태로 변경, 예매 내역, 결제 내역 `취소`로 업데이트
</br>

# 결제
<img src="https://github.com/user-attachments/assets/8eb37245-f362-4e25-be18-7a54c40ca735" width="70%">

## 결제 사전 검증
* 결제 요청은 스크립트를 조작하여 금액을 변조할 수 있다.
* PG로 결제 요청 전 주문 번호와 결제 금액을 서버로 전송하여 등록
* PG로 결제 요청된 금액이 사전에 등록한 금액과 일치하지 않을 경우 결제 차단
</br>

## 결제 사후 검증
* 정상 결제 처리 후 반환된 결제 번호와 결제 금액을 서버로 전송
* 서버에서 PG로 실제 결제 내역을 조회하여 요청 금액과 다를 경우 결제 취소 및 예매 실패 처리
* 검증이 통과할 경우 예매 확정
</br>

# 티켓
티켓 가격은 다음과 같이 계산된다.
1. 기본 가격 ex) 10,000원
2. 시간대별 요금 설정
   - 조조(아침) 할인: 20% 할인 (오전 6시 ~ 오전 10시)
   - 심야(밤) 할인: 10% 할인 (밤 10시 ~ 새벽 2시)
3. 상영관 유형 요금 설정
   - ex) IMAX 상영관: +3,000원
   - ex) 3D 상영관: +2,000원
   - 지역별로 다른 요금일 가능성 있음
